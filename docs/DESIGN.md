# InsightQuant Agent 量化投资 WebUI 系统需求说明

> **版本**:  v1.0  
> **创建日期**: 2026-01-17  
> **目标**: 为开发代理（Superpowers/类似 agent）提供可执行的产品需求定义

---

## 1. 产品目标与范围

### 1.1 核心目标
- 将 LLM Research Engine（MiroThinker/多种 LLM）与 RD-Agent（量化研发 agent）的能力融合，构建面向普通散户的 AI 量化投资助手
- 通过 WebUI 将复杂的 agent 协作流程封装为简单的用户交互，降低量化投资门槛
- 实现从"用户问题"到"可执行投资建议"的端到端自动化流程

### 1.2 产品范围
**包含功能**: 
- 多股票筛选（行业/板块级别选股）
- 单股票深度分析（个股尽调 + 量化验证）
- 研究报告可视化展示（定性 + 定量融合）
- 实时 agent 执行状态监控
- 历史分析记录查询

**不包含功能**: 
- 实盘交易执行（不做券商接口对接）
- 用户资产管理（不存储真实资金信息）
- 社交功能（不做用户间互动）
- 移动端原生 App（仅 Web 响应式）

### 1.3 成功标准
- Agent 执行过程的透明度可追溯（用户能看到"AI 在做什么"）
- 分析结果的可解释性（普通人能理解"为什么推荐这只股票"）

---

## 2. 目标用户画像与典型场景

### 2.1 主要用户画像

目标用户为普通散户投资者，从新手到进阶投资者：
- **核心痛点**: 信息过载、缺乏系统化研究方法、难以做出理性投资决策
- **核心期望**: 获得易于理解的投资建议，并看到支撑决策的证据（定性+定量）

### 2.2 典型使用场景

#### 场景 1：行业/板块选股
用户输入行业或板块关键词，系统通过 LLM Research Engine 获取行业洞察，结合 RD-Agent 的量化因子，返回排序后的股票列表及推荐理由。

#### 场景 2：个股投资决策
用户询问特定股票的买卖建议，系统融合定性研究和量化验证，给出明确的操作建议（买入/持有/卖出）及风险提示。

---

## 3. 核心功能清单

### 3.1 功能优先级分级

#### P0（MVP 必需）
- **多股选股功能**: 根据行业/概念输入，返回排序后的股票列表
- **单股分析功能**: 输入股票代码，返回投资建议 + 分析报告
- **Agent 执行监控**: 实时显示 LLM Research Engine / RD-Agent 的工作进度
- **结果展示**: 将分析结果以表格 + 图表 + 文本形式呈现

#### P1（增强体验）
- **历史记录**:  保存用户过往的分析任务，支持回溯查看
- **报告导出**: 将分析结果导出为 PDF/Markdown 文件
- **自定义参数**: 允许用户调整风险偏好、投资期限等参数
- **批量对比**: 同时分析多只股票并生成对比报告

#### P2（长期优化）
- **订阅监控**: 对关注的股票进行定期分析，变化时通知用户
- **解释性增强**: 点击任何结论都能看到推导过程（类似"显示思考过程"）

---

## 4. 页面与信息架构

### 4.1 页面结构

页面应包含三个核心区域：

1. **任务创建区**
   - 支持自然语言输入
   - 任务类型选择（多股选股/单股分析）
   - 可选参数配置

2. **执行监控区**
   - 显示 Agent 执行状态和进度
   - 实时日志流

3. **结果展示区**
   - 投资建议摘要
   - 定性分析（LLM Research Engine）和定量验证（RD-Agent）
   - 支持报告导出和历史记录保存

### 4.2 模块划分

#### 前端
- 用户输入和参数配置
- Agent 执行状态追踪和可视化
- 结果展示（图表、报告渲染）
- 交互功能（导出、保存、历史记录）

#### 后端
- 任务管理和编排
- LLM Research Engine（MiroThinker/多种 LLM）与 RD-Agent 集成
- 数据融合和结果生成
- 缓存和性能优化

---

## 5. 与后端/Agent 的��互点与数据流

### 5.1 关键交互点

系统需要以下核心 API 接口：

1. **任务提交**: 接收用户问题和参数，创建分析任务
2. **状态查询**: 实时返回任务执行状态、进度和日志
3. **结果获取**: 返回完整的分析结果，包括：
   - 投资建议（操作、置信度、理由）
   - 定性分析（LLM Research Engine 输出的结构化报告）
   - 定量验证（RD-Agent 因子和回测数据）
   - 股票列表（多股选股场景）

### 5.2 核心数据流

系统的基本执行流程：

1. **用户输入** → 前端验证和参数化
2. **多模型研究** → 通过提示词驱动生成定性分析结构化报告
3. **RD-Agent 验证** → 基于结构化报告进行量化验证和因子回测
4. **结果融合** → 合并定性和定量分析，生成投资建议
5. **结果展示** → 前端渲染并支持交互

任务状态：`queued` → `running` → `completed` 或 `error`

### 5.2.1 完整工作流（关键技术细节）

```
┌─────────────────────────────────────────────────────────────┐
│                    完整工作流                                 │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  步骤1: 多模型自动化研究                                       │
│    目的: 通过 multi-agent 大模型能力获取行业内的大致信息，      │
│          形成结构化报告供步骤2分析使用                          │
│    输入:   "分析半导体行业投资机会"                             │
│    过程:  我们提供一段提示词给 MiroThinker / LLM 模型，         │
│          由其自身能力完成搜索→爬取→推理（多工具调用）            │
│          支持多种 LLM（如 gemini-3-pro、gpt-5.2 等官方 API）     │
│    输出:  research_report.md（结构化报告）→ 注入步骤2 RD-Agent  │
│                                                             │
│  步骤2: 将报告注入RD-Agent的研究循环                           │
│    【迭代0】（特殊轮）:                                         │
│      ├─ 输入 LLM Research Engine 的结构化报告作为"外部知识"   │
│      └─ RD-Agent提取假设：                                    │
│          "报告提到'AI芯片需求增长' → 生成因子"                 │
│                                                             │
│    【迭代1-N】（常规轮）:                                      │
│      ├─ RD-Agent自己的研究循环                               │
│      │   • Research Agent:  生成新假设                        │
│      │   • Development Agent: 实现因子代码                   │
│      │   • Runner:  Qlib回测                                 │
│      │   • Feedback: 根据IC/Sharpe优化                      │
│      │                                                      │
│      └─ 知识获取方式（3种）:                                  │
│          A. MCP Server（Tavily/Exa等）→ 实时搜索              │
│          B. LLM Web-Search功能 → 调用GPT搜索                 │
│          C. 本地RAG（可选）→ 历史因子库                       │
│                                                             │
│  步骤3: RD-Agent输出最终结论                                  │
│    • 多股选股:  Top 10股票 + 因子得分                          │
│    • 单股分析:  AAPL投资建议 + 量化支撑                         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 5.3 核心数据要求

系统需要存储和传递以下核心数据：

- **任务对象**: 包含任务ID、类型、用户输入、状态、进度、时间戳等
- **LLM Research Engine 输出**: 结构化研究报告、关键洞察、数据来源
- **RD-Agent 输出**: 因子列表、回测结果、股票排名
- **最终结果**: 投资建议、综合分析、可视化数据

---

## 6. 约束与非目标

### 6.1 技术约束

- **性能**: 需要控制 Agent 工具调用次数和迭代轮数，避免执行超时
- **数据**: 历史回测数据应覆盖近几年，股票池包含主要市场（A股、美股）
- **成本**: 需控制 LLM API 调用成本，实施合理的缓存策略
- **并发**: 单用户同时执行的任务数应有合理限制

### 6.2 产品约束

#### 合规约束
- **必须**：每个投资建议都包含免责声明
- **必须**：标注"AI 生成内容，仅供参考"
- **禁止**：提供"保证收益"类承诺
- **禁止**：直接执行交易（不接入券商 API）

#### 用户体验约束
- 所有技术术语需提供悬浮解释（如"IC 值"）
- 分析结果必须包含"白话版"解释
- 错误提示需对用户友好（不暴露技术堆栈）

### 6.3 明确非目标

#### 不做的��能
- ❌ 实时行情推送（ticker 实时涨跌）
- ❌ 社交分享/跟单功能
- ❌ 用户资产管理/持仓追踪
- ❌ 自动交易执行
- ❌ 模拟盘/虚拟交易
- ❌ 移动端原生 App（初期仅 Web）

#### 不解决的问题
- ❌ 不保证分析结果的准确性（市场不可预测）
- ❌ 不对用户投资损失负责
- ❌ 不提供人工客服/投资咨询
- ❌ 不支持高频交易/算法交易策略

#### 暂不考虑的场景
- 衍生品分析（期权/期货）
- 跨市场套利策略
- 加密货币投资
- 固收类产品分析

---

## 9. 参考资料与上下文

### 9.1 相关技术文档
- MiroThinker GitHub:  https://github.com/MiroMindAI/MiroThinker
- RD-Agent GitHub: https://github.com/microsoft/RD-Agent
- Qlib 文档: https://qlib.readthedocs.io/
- MCP Protocol:  https://modelcontextprotocol.io/

---

## 10. 附录：术语表

| 术语 | 解释 | 目标受众 |
|-----|------|---------|
| **多股选股** | 从一组股票中筛选出最优的 N 只 | 所有用户 |
| **单股分析** | 对某只股票进行深度研究并给出投资建议 | 所有用户 |
| **因子** | 用于预测股票收益的数学指标（如市盈率、动量） | 进阶用户 |
| **回测** | 用历史数据验证策略的有效性 | 进阶用户 |
| **IC 值** | 因子预测能力指标（-1 到 1，越接近 1 越好） | 量化爱好者 |
| **Sharpe 比率** | 风险调整后收益指标（>1 为优秀） | 量化爱好者 |
| **MCP Server** | Model Context Protocol 服务器，提供工具调用能力 | 开发者 |
| **Agent 迭代** | RD-Agent 的一轮研究循环（假设→实现→验证→反馈） | 开发者 |

---
